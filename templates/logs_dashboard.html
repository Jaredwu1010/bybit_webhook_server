<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Webhook Logs Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-4">
    <h3 class="mb-3 fw-bold">Webhook Logs Dashboard</h3>

    <form class="d-flex mb-3" method="post" action="/reset_strategy">
      <select class="form-select me-2" name="strategy_id" style="max-width: 200px;">
        {% for r in records|reverse %}
          {% set base_id = r.strategy_id.split("_")[0] + "_" + r.strategy_id.split("_")[1] %}
          {% if base_id not in seen_ids %}
            <option value="{{ base_id }}">{{ base_id }}</option>
            {% set _ = seen_ids.append(base_id) %}
          {% endif %}
        {% endfor %}
      </select>
      <input class="form-control me-2" name="reset_secret" placeholder="å¯†ç¢¼" type="password" style="max-width: 180px;">
      <button class="btn btn-danger me-2" type="submit">ğŸ” Reset</button>
      <a class="btn btn-primary" href="/download/log.json">â¬‡ ä¸‹è¼‰ log.json</a>
    </form>

    <div class="d-flex justify-content-between mb-4" style="gap: 1rem;">
      <div class="card flex-fill text-center">
        <div class="card-body p-2">
          <img src="/static/win_rate.png" class="img-fluid" alt="Win Rate">
        </div>
      </div>
      <div class="card flex-fill text-center">
        <div class="card-body p-2">
          <img src="/static/equity_curve.png" class="img-fluid" alt="Equity Curve">
        </div>
      </div>
      <div class="card flex-fill text-center">
        <div class="card-body p-2">
          <img src="/static/mdd_distribution.png" class="img-fluid" alt="MDD Distribution">
        </div>
      </div>
    </div>

    <div class="card">
      <div class="table-responsive">
        <table class="table table-striped table-bordered mb-0">
          <thead class="table-light">
            <tr>
              <th>æ™‚é–“</th>
              <th>ç­–ç•¥ ID</th>
              <th>äº‹ä»¶</th>
              <th>Equity</th>
              <th>Drawdown</th>
              <th>ä¸‹å–®å‹•ä½œ</th>
            </tr>
          </thead>
          <tbody>
            {% for r in records|reverse %}
              <tr>
                <td>{{ r.timestamp }}</td>
                <td>{{ r.strategy_id }}</td>
                <td>{{ r.event }}</td>
                <td>{{ r.equity or '' }}</td>
                <td>{{ r.drawdown or '' }}</td>
                <td>{{ r.order_action or '' }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
